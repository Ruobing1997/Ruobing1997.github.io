<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Code-Refactor | Robin's Blog</title><meta name="author" content="Ruobing Wang"><meta name="copyright" content="Ruobing Wang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="代码重构">
<meta property="og:type" content="article">
<meta property="og:title" content="Code-Refactor">
<meta property="og:url" content="http://ruobingw.com/posts/Code-Refactor/index.html">
<meta property="og:site_name" content="Robin&#39;s Blog">
<meta property="og:description" content="代码重构">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://ruobingw.com/posts/Code-Refactor/Code-Refactor-Cover.png">
<meta property="article:published_time" content="2023-11-17T22:32:40.000Z">
<meta property="article:modified_time" content="2024-05-15T04:17:52.558Z">
<meta property="article:author" content="Ruobing Wang">
<meta property="article:tag" content="代码重构">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ruobingw.com/posts/Code-Refactor/Code-Refactor-Cover.png"><link rel="shortcut icon" href="/images/logo.png"><link rel="canonical" href="http://ruobingw.com/posts/Code-Refactor/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-54HWWM1WE5"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-54HWWM1WE5');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: Ruobing Wang","link":"Link: ","source":"Source: Robin's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Code-Refactor',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-15 00:17:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/config/css/categoryBar.css" type="text/css"><link rel="stylesheet" href="/config/css/nav.css" type="text/css"><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Robin's Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> Articles</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/posts/Code-Refactor/Code-Refactor-Cover.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Robin's Blog"><span class="site-name">Robin's Blog</span></a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> About</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> Articles</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"> <a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Code-Refactor</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-11-17T22:32:40.000Z" title="Created 2023-11-17 17:32:40">2023-11-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-05-15T04:17:52.558Z" title="Updated 2024-05-15 00:17:52">2024-05-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E7%A8%8B%E7%B1%BB/">工程类</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Code-Refactor"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Code-Smells"><a href="#Code-Smells" class="headerlink" title="Code Smells"></a>Code Smells</h1><p>需要避免这些</p>
<h2 id="Bloaters"><a href="#Bloaters" class="headerlink" title="Bloaters:"></a>Bloaters:</h2><p>Code, methods and classes that have invreased to such gargantuan proportions that are hard to work with. They accumulate over time as the program evolves</p>
<h3 id="Long-Method"><a href="#Long-Method" class="headerlink" title="Long Method"></a>Long Method</h3><p>A method contains too many lines of code</p>
<p>(Method that is longer than ten lines should take care about it)</p>
<h4 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h4><p>一般情况下加入原本方法比添加新方法看起来要简单一些并且方法的长度是逐渐增长的，因此是不容易被一次发现的。</p>
<h4 id="方案："><a href="#方案：" class="headerlink" title="方案："></a>方案：</h4><p>As a rule of thumb, <strong>if you feel the need to comment on something inside a method</strong>, you should <strong>take this code and put it in a new method.</strong></p>
<h5 id="Extract-Method"><a href="#Extract-Method" class="headerlink" title="Extract Method"></a>Extract Method</h5><p>合并逻辑相通的代码：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bad:</span></span><br><span class="line"><span class="comment">// code fragment that can be grouped together</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">printOwing</span><span class="params">()</span> {</span><br><span class="line">  printBanner();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Print details.</span></span><br><span class="line">  System.out.println(<span class="string">"name: "</span> + name);</span><br><span class="line">  System.out.println(<span class="string">"amount: "</span> + getOutstanding());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Good:</span></span><br><span class="line"><span class="comment">// Move this code to a separate new method (or function) and replace the old code with a call to the method.</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">printOwing</span><span class="params">()</span> {</span><br><span class="line">  printBanner();</span><br><span class="line">  printDetails(getOutstanding());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">printDetails</span><span class="params">(<span class="type">double</span> outstanding)</span> {</span><br><span class="line">  System.out.println(<span class="string">"name: "</span> + name);</span><br><span class="line">  System.out.println(<span class="string">"amount: "</span> + outstanding);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="Reduce-local-variables-and-parameters-before-extracting-a-method"><a href="#Reduce-local-variables-and-parameters-before-extracting-a-method" class="headerlink" title="Reduce local variables and parameters before extracting a method"></a>Reduce local variables and parameters before extracting a method</h5><p>If local variables and parameters interfere with extracting a method, use </p>
<ul>
<li><strong>Replace Temp with Query</strong></li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bad:</span></span><br><span class="line"><span class="comment">// place the result of an expression in a local variable for later use in your code.</span></span><br><span class="line"><span class="type">double</span> <span class="title function_">calculateTotal</span><span class="params">()</span> {</span><br><span class="line">  <span class="type">double</span> <span class="variable">basePrice</span> <span class="operator">=</span> quantity * itemPrice;</span><br><span class="line">  <span class="keyword">if</span> (basePrice &gt; <span class="number">1000</span>) {</span><br><span class="line">    <span class="keyword">return</span> basePrice * <span class="number">0.95</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="keyword">return</span> basePrice * <span class="number">0.98</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Good:</span></span><br><span class="line"><span class="comment">// Move the entire expression to a separate method and return the result from it. Query the method instead of using a variable. Incorporate the new method in other methods, if necessary.</span></span><br><span class="line"><span class="type">double</span> <span class="title function_">calculateTotal</span><span class="params">()</span> {</span><br><span class="line">  <span class="keyword">if</span> (basePrice() &gt; <span class="number">1000</span>) {</span><br><span class="line">    <span class="keyword">return</span> basePrice() * <span class="number">0.95</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="keyword">return</span> basePrice() * <span class="number">0.98</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="type">double</span> <span class="title function_">basePrice</span><span class="params">()</span> {</span><br><span class="line">  <span class="keyword">return</span> quantity * itemPrice;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<ul>
<li><strong>Introduce Parameter Object</strong></li>
</ul>
<p>Methods contain a repeating group of parameters:</p>
<p>![Introduce Parameter Object - Before](/posts/Code-Refactor/Introduce Parameter Object - Before.png)</p>
<p>Replace these parameters with an object:</p>
<p>![Introduce Parameter Object - After](/posts/Code-Refactor/Introduce Parameter Object - After.png)</p>
<ul>
<li><strong>Preserve Whole Object</strong>.</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bad: Several values are from an object and then pass them as parameters to a method:</span></span><br><span class="line"><span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> daysTempRange.getLow();</span><br><span class="line"><span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> daysTempRange.getHigh();</span><br><span class="line"><span class="type">boolean</span> <span class="variable">withinPlan</span> <span class="operator">=</span> plan.withinRange(low, high);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Good: Pass the whole object</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">withinPlan</span> <span class="operator">=</span> plan.withinRange(daysTempRange);</span><br></pre></td></tr></tbody></table></figure>

<h5 id="Replace-Method-with-Method-Object"><a href="#Replace-Method-with-Method-Object" class="headerlink" title="Replace Method with Method Object"></a>Replace Method with Method Object</h5><p>If none of the previous recipes help, try moving the entire method to a separate object via <strong>Replace Method with Method Object</strong>.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bad: A long method in which the local variables are so intertwined that you can't apply Extract Method.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">price</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">double</span> primaryBasePrice;</span><br><span class="line">    <span class="type">double</span> secondaryBasePrice;</span><br><span class="line">    <span class="type">double</span> tertiaryBasePrice;</span><br><span class="line">    <span class="comment">// Perform long computation.</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// Good: Transform the method into a separate class so that the local variables become fields of the class. Then you can split the method into several methods within the same class.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">price</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PriceCalculator</span>(<span class="built_in">this</span>).compute();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PriceCalculator</span> {</span><br><span class="line">  <span class="keyword">private</span> <span class="type">double</span> primaryBasePrice;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">double</span> secondaryBasePrice;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">double</span> tertiaryBasePrice;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">PriceCalculator</span><span class="params">(Order order)</span> {</span><br><span class="line">    <span class="comment">// Copy relevant information from the</span></span><br><span class="line">    <span class="comment">// order object.</span></span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">compute</span><span class="params">()</span> {</span><br><span class="line">    <span class="comment">// Perform long computation.</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="Conditionals-and-Loops"><a href="#Conditionals-and-Loops" class="headerlink" title="Conditionals and Loops"></a>Conditionals and Loops</h5><p><code>if判断</code>和<code>loop</code>可以尝试放在一个单独的方法中</p>
<p>For conditionals, use <strong>Decompose Conditional</strong>. </p>
<p>If loops are in the way, try <strong>Extract Method</strong>.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Bad: complex conditional (if-then/else or switch).</span></span><br><span class="line"><span class="keyword">if</span> (date.before(SUMMER_START) || date.after(SUMMER_END)) {</span><br><span class="line">  charge = quantity * winterRate + winterServiceCharge;</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  charge = quantity * summerRate;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// Good: Decompose the complicated parts of the conditional into separate methods: the condition, then and else.</span></span><br><span class="line"><span class="keyword">if</span> (isSummer(date)) {</span><br><span class="line">  charge = summerCharge(quantity);</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  charge = winterCharge(quantity);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad: Code fragment that can be grouped together.</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">printProperties</span><span class="params">(List users)</span> {</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; users.size(); i++) {</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">""</span>;</span><br><span class="line">    result += users.get(i).getName();</span><br><span class="line">    result += <span class="string">" "</span>;</span><br><span class="line">    result += users.get(i).getAge();</span><br><span class="line">    System.out.println(result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"><span class="comment">// Good: Move this code to a separate new method (or function) and replace the old code with a call to the method.</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">printProperties</span><span class="params">(List users)</span> {</span><br><span class="line">  <span class="keyword">for</span> (User user : users) {</span><br><span class="line">    System.out.println(getProperties(user));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">String <span class="title function_">getProperties</span><span class="params">(User user)</span>  {</span><br><span class="line">  <span class="keyword">return</span> user.getName() + <span class="string">" "</span> + user.getAge();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>更多的方法带来的性能差是可以忽略的且更易读的代码能够带来更好的结构化以及潜在优化</p>
<h3 id="Large-Class"><a href="#Large-Class" class="headerlink" title="Large Class"></a>Large Class</h3><p>Class that contains many fields/method/lines of code</p>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>和 Long Method 类似，只管认为加field比加class要容易的多</p>
<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4><p>When a class is wearing too many (functional) hats, think about splitting it up.</p>
<h5 id="Extract-as-Class"><a href="#Extract-as-Class" class="headerlink" title="Extract (as) Class"></a>Extract (as) Class</h5><p><strong>Extract Class</strong> helps if part of the behavior of the large class can be spun off into a separate component. 分离部分行为到单独的组件中</p>
<p><img src="/posts/Code-Refactor/large_class_1.png" alt="large_class_1"></p>
<h5 id="Extract-as-Subclass"><a href="#Extract-as-Subclass" class="headerlink" title="Extract (as) Subclass"></a>Extract (as) Subclass</h5><p><strong>Extract Subclass</strong> helps if part of the behavior of the large class can be implemented in different ways or is used in rare cases. </p>
<p><img src="/posts/Code-Refactor/large_class_2.png" alt="large_class_2"></p>
<h5 id="Extract-as-Interface"><a href="#Extract-as-Interface" class="headerlink" title="Extract (as) Interface"></a>Extract (as) Interface</h5><p><strong>Extract Interface</strong> helps if it’s necessary to have a list of the operations and behaviors that the client can use.</p>
<p><img src="/posts/Code-Refactor/large_class_3.png" alt="large_class_3"></p>
<h5 id="Duplicate-Observed-Data"><a href="#Duplicate-Observed-Data" class="headerlink" title="Duplicate Observed Data"></a>Duplicate Observed Data</h5><p>If a large class is responsible for the graphical interface, you may try to move some of its data and behavior to a separate domain object. In doing so, it may be necessary to store copies of some data in two places and keep the data consistent. Duplicate Observed Data offers a way to do this.</p>
<p>当一个类负责图形界面(GUI)时，同时还包含域(domain)数据的问题。在这个问题中，图形界面和域数据的逻辑耦合在了一起，这可能导致类变得过于复杂，并且难以维护。</p>
<p><img src="/posts/Code-Refactor/large_class_4.png" alt="large_class_4"></p>
<p>这张图展示了代码重构的一个常见模式，即“Duplicate Observed Data”模式。这个模式解决了当一个类负责图形界面(GUI)时，同时还包含域(domain)数据的问题。在这个问题中，图形界面和域数据的逻辑耦合在了一起，这可能导致类变得过于复杂，并且难以维护。</p>
<p><strong>问题（左侧）:</strong> 在重构前的设计中，<code>IntervalWindow</code> 类同时负责显示信息（GUI）和存储数据（域数据）。这个类中有三个文本字段（<code>TextField</code>），每个字段都有对应的失去焦点（FocusLost）事件处理函数，还有计算长度和计算结束时间的函数。这样的设计让 <code>IntervalWindow</code> 类承担了过多的职责，违反了单一职责原则，也使得该类过于庞大且难以测试。</p>
<p><strong>解决方案（右侧）:</strong> 图展示了如何将域数据从 <code>IntervalWindow</code> 类中分离出来，创建了一个新的 <code>Interval</code> 类。<code>IntervalWindow</code> 依然保留有界面相关的文本字段和事件处理函数，但是域数据（起始时间、结束时间和长度）现在被移到了新的 <code>Interval</code> 类中，这个类有自己的起始时间、结束时间和长度属性，以及计算长度和计算结束时间的方法。</p>
<p><strong>这样做的好处包括:</strong></p>
<ol>
<li><strong>单一职责原则</strong>：每个类都只处理一个职责，<code>IntervalWindow</code> 负责界面的显示，而 <code>Interval</code> 负责数据的处理。</li>
<li><strong>更容易测试</strong>：因为 <code>Interval</code> 类只处理数据，所以比起含有GUI代码的类，它更容易进行单元测试。</li>
<li><strong>更低的耦合度</strong>：这种分离减少了类之间的依赖性，使得修改界面或数据模型时，可以减少对另一部分的影响。</li>
<li><strong>更容易维护和扩展</strong>：清晰的分离使得后续维护和添加新功能时更加简单。</li>
</ol>
<p>在这种模式下，<code>IntervalWindow</code> 类会观察（Observe） <code>Interval</code> 类的实例。当 <code>Interval</code> 的数据发生变化时，<code>IntervalWindow</code> 可以更新其显示的数据。这通常通过某种形式的观察者模式来实现，其中 <code>Interval</code> 类会通知所有注册的观察者数据的变化。这样，任何时候 <code>Interval</code> 的数据改变了，<code>IntervalWindow</code> 都可以得到通知，并更新用户界面。</p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ul>
<li>Refactoring of these classes spares developers from needing to remember a large number of attributes for a class. [重构这些类使开发人员无需记住类的大量属性。]</li>
<li>In many cases, splitting large classes into parts avoids duplication of code and functionality. [在许多情况下，将大类分成几个部分可以避免代码和功能的重复。]</li>
</ul>
<h3 id="Primitive-Obsession"><a href="#Primitive-Obsession" class="headerlink" title="Primitive Obsession"></a>Primitive Obsession</h3><ul>
<li>Use of primitives instead of small objects for simple tasks (such as currency, ranges, special strings for phone numbers, etc.)</li>
<li>Use of constants for coding information (such as a constant <code>USER_ADMIN_ROLE = 1</code> for referring to users with administrator rights.)</li>
<li>Use of string constants as field names for use in data arrays.</li>
</ul>
<p>“Primitive obsession”是一个常见的编码问题，指的是开发者过度使用原始数据类型（如int、float、boolean等）来表示应该由对象表示的概念。这个术语反映了一种倾向：即使在面向对象编程中，也倾向于使用基本数据类型而不是设计小型的类来表示具有业务逻辑的概念。</p>
<p>解决”primitive obsession”可以提高代码的可读性、可维护性和灵活性。</p>
<ol>
<li><p><strong>使用原始数据类型而不是小对象进行简单任务</strong>：</p>
<ul>
<li>这里的“primitive”是指原始数据类型。例如，使用<code>int</code>或<code>double</code>来表示货币值可能会导致精度问题和缺乏表达力。更好的做法是创建一个<code>Currency</code>类，它可以封装货币的值和货币类型（比如美元、欧元等），同时提供货币相关的操作和转换。</li>
</ul>
</li>
<li><p><strong>使用常量进行编码信息</strong>：</p>
<ul>
<li>在这个上下文中，使用类似<code>USER_ADMIN_ROLE = 1</code>的常量代表了一种“primitive”的使用方式，因为它使用数字（一个原始类型）来代表用户角色。这种做法的问题在于它通常不够表达，而且容易出错。替代的方法是使用枚举（Enum）或者小型类，这样可以提供更加类型安全和描述性更强的方法来代表用户角色。</li>
</ul>
</li>
<li><p><strong>使用字符串常量作为数据数组中的字段名称</strong>：</p>
<ul>
<li><p>在这种情况下，“primitive”通常是指字符串类型。例如，当使用字符串来访问数据结构中的值时，这可能会导致拼写错误和与数据结构的耦合。通过创建小型类或结构体，我们可以更安全地封装数据，同时还可以提供更清晰的API和错误检查。</p>
</li>
<li><p>当然可以。使用字符串常量作为数据数组中的字段名称通常发生在我们处理键值对集合，如JSON对象或者Java中的<code>Map</code>时。</p>
<p>假设我们有一个表示用户的<code>Map</code>，在没有使用小对象封装的情况下，它可能看起来是这样的：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; user = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">user.put(<span class="string">"name"</span>, <span class="string">"John Doe"</span>);</span><br><span class="line">user.put(<span class="string">"email"</span>, <span class="string">"john.doe@example.com"</span>);</span><br><span class="line">user.put(<span class="string">"role"</span>, <span class="number">1</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>在上述代码中，字段名称如<code>"name"</code>、<code>"email"</code>和<code>"role"</code>都是直接使用字符串常量。这种方式的问题在于，它容易出错（比如拼写错误）并且不利于重构（比如当字段名称变更时，所有的字符串都需要修改）。</p>
<p>一个更好的做法是使用常量来代替这些字符串字面量：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConstants</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NAME</span> <span class="operator">=</span> <span class="string">"name"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EMAIL</span> <span class="operator">=</span> <span class="string">"email"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ROLE</span> <span class="operator">=</span> <span class="string">"role"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; user = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">user.put(UserConstants.NAME, <span class="string">"John Doe"</span>);</span><br><span class="line">user.put(UserConstants.EMAIL, <span class="string">"john.doe@example.com"</span>);</span><br><span class="line">user.put(UserConstants.ROLE, <span class="number">1</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>这样，如果字段名需要更改，我们只需要在<code>UserConstants</code>类中修改一次，而不需要在整个代码库中寻找和替换所有的硬编码字符串。</p>
<p>但是，要彻底解决”primitive obsession”的问题，我们应该创建一个用户类来封装这些属性：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> role;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, String email, <span class="type">int</span> role)</span> {</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.role = role;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里可以添加getter和setter方法</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">"John Doe"</span>, <span class="string">"john.doe@example.com"</span>, <span class="number">1</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>现在，我们有了一个类型安全的对象，其中的字段名称是类的属性，而不是字符串字面量。这种方式不仅减少了错误的机会，而且使得代码更容易阅读和维护。此外，<code>User</code>类可以包含逻辑，比如验证电子邮件的格式或者确定用户角色的权限。</p>
</li>
</ul>
</li>
</ol>
<p>简而言之，在这些情况下，”primitive”通常指的是基本数据类型或者直接使用的常量。”Primitive obsession”可能会导致代码难以理解和维护，因为它缺乏抽象层，使得代码中的业务逻辑不够明确。通过引入小对象来封装复杂性，代码会变得更加清晰和健壮。</p>
<h4 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h4><p>Like most other smells, primitive obsessions are born in moments of weakness. “Just a field for storing some data!” the programmer said. Creating a primitive field is so much easier than making a whole new class, right? And so it was done. Then another field was needed and added in the same way. Lo and behold, the class became huge and unwieldy. - 简单就加了</p>
<p>Primitives are often used to “simulate” types. So instead of a separate data type, you have a set of numbers or strings that form the list of allowable values for some entity. Easy-to-understand names are then given to these specific numbers and strings via constants, which is why they’re spread wide and far. - 用于代表一些东西</p>
<p>Another example of poor primitive use is field simulation. The class contains a large array of diverse data and string constants (which are specified in the class) are used as array indices for getting this data.</p>
<h4 id="方案-1"><a href="#方案-1" class="headerlink" title="方案"></a>方案</h4><h5 id="Replace-Set-of-Fields-with-Object"><a href="#Replace-Set-of-Fields-with-Object" class="headerlink" title="Replace Set of Fields with Object"></a>Replace Set of Fields with Object</h5><p>If you have a large variety of primitive fields, it may be possible to logically group some of them into their own class. Even better, move the behavior associated with this data into the class too. For this task, try <strong>Replace Data Value with Object</strong>.</p>
<p><img src="/posts/Code-Refactor/primitive_obsession_1.png" alt="primitive_obsession_1"></p>
<p>将一部分原始变量打包进入一个class</p>
<h5 id="Primitive-Fields-in-Method-Parameters"><a href="#Primitive-Fields-in-Method-Parameters" class="headerlink" title="Primitive Fields in Method Parameters"></a>Primitive Fields in Method Parameters</h5><p>If the values of primitive fields are used in method parameters, go with <strong>Introduce Parameter Object</strong> or <strong>Preserve Whole Object</strong>.</p>
<p><img src="/posts/Code-Refactor/primitive_obsession_2.png" alt="primitive_obsession_2"></p>
<p>在这个示例中，“primitive fields”指的是原始数据类型的字段。在Java语言中，原始类型（primitive types）包括基础的数据类型，例如<code>int</code>、<code>double</code>、<code>float</code>、<code>boolean</code>等，它们不是对象，不属于任何类的实例，并且通常用于表示简单的数值或真/假值。</p>
<p>然而，在这个上下文中，术语“primitive fields”可能被用来泛指那些<strong>没有被封装在对象中的简单数据类型的字段</strong>。例如，在方法参数中直接使用两个<code>Date</code>类型的参数（<code>start</code>和<code>end</code>）而不是一个封装了这两个字段的对象。虽然<code>Date</code>类型在Java中不是原始类型（它实际上是一个对象），这里的“primitive”可能是用来指代那些还没有被进一步抽象或封装的字段。</p>
<p>“引入参数对象”（Introduce Parameter Object）。该策略的目的是简化方法签名并提高代码的可读性和可维护性。</p>
<ul>
<li><p><strong>问题</strong>：有多个方法（如<code>amountInvoicedIn</code>、<code>amountReceivedIn</code>和<code>amountOverdueIn</code>）接受相同的参数（<code>start</code>和<code>end</code>日期），这导致了重复的参数组，并且每次调用这些方法时都需要重复这些参数。</p>
</li>
<li><p><strong>解决方案</strong>：创建一个新的类或对象来封装这些参数，例如<code>DateRange</code>对象，它包含<code>start</code>和<code>end</code>日期。然后，可以将这个对象作为单个参数传递给方法，从而减少参数的数量并使方法调用更加清晰。</p>
</li>
</ul>
<p>重构后，方法调用变得更加简洁，因为只需要传递一个<code>DateRange</code>对象而不是两个分开的<code>Date</code>对象。这样做的好处包括减少重复代码，使方法调用更加直观，以及提供了进一步重构的可能性，例如，如果将来需要在日期范围中添加更多的信息或功能，只需要修改<code>DateRange</code>类即可。</p>
<p>让我们用Java代码举个例子：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重构前的代码，方法参数中直接使用了Date类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">amountInvoicedIn</span><span class="params">(Date start, Date end)</span> {</span><br><span class="line">        <span class="comment">// 计算逻辑...</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">amountReceivedIn</span><span class="params">(Date start, Date end)</span> {</span><br><span class="line">        <span class="comment">// 计算逻辑...</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">amountOverdueIn</span><span class="params">(Date start, Date end)</span> {</span><br><span class="line">        <span class="comment">// 计算逻辑...</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重构后的代码，引入了一个新的DateRange类来封装日期范围</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateRange</span> {</span><br><span class="line">    <span class="keyword">private</span> Date start;</span><br><span class="line">    <span class="keyword">private</span> Date end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DateRange</span><span class="params">(Date start, Date end)</span> {</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// DateRange类的其他有用方法和逻辑...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">amountInvoicedIn</span><span class="params">(DateRange dateRange)</span> {</span><br><span class="line">        <span class="comment">// 使用dateRange.getStart()和dateRange.getEnd()进行计算...</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">amountReceivedIn</span><span class="params">(DateRange dateRange)</span> {</span><br><span class="line">        <span class="comment">// 使用dateRange.getStart()和dateRange.getEnd()进行计算...</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">amountOverdueIn</span><span class="params">(DateRange dateRange)</span> {</span><br><span class="line">        <span class="comment">// 使用dateRange.getStart()和dateRange.getEnd()进行计算...</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在这个重构的过程中，通过引入<code>DateRange</code>类，我们不仅简化了方法签名，而且提高了代码的可读性和可维护性。这也是设计模式中的封装原则的一个应用。</p>
<p>另一个方法是保留整个Object</p>
<p><img src="/posts/Code-Refactor/primitive_obsession_3.png" alt="primitive_obsession_3"></p>
<h5 id="Get-Rid-of-Type-codes"><a href="#Get-Rid-of-Type-codes" class="headerlink" title="Get Rid of Type codes"></a>Get Rid of Type codes</h5><p>When complicated data is coded in variables, use <strong>Replace Type Code with Class</strong>, <strong>Replace Type Code with Subclasses</strong> or <strong>Replace Type Code with State/Strategy</strong>.</p>
<p><img src="/posts/Code-Refactor/primitive_obsession_4.png" alt="primitive_obsession_4"></p>
<p><img src="/posts/Code-Refactor/primitive_obsession_5.png" alt="primitive_obsession_5"></p>
<p><img src="/posts/Code-Refactor/primitive_obsession_6.png" alt="primitive_obsession_6"></p>
<p>有时候，使用子类可能不是最佳选择，特别是当类型代码影响对象的状态，但又不能或不应该用子类来表示时。在这种情况下，可以使用状态或策略模式来替换类型代码。</p>
<p>状态/策略模式允许你将行为封装在不同的对象中，并在运行时切换对象的行为。你创建一个状态接口或策略接口，并为每种类型代码创建实现该接口的具体类。然后，你可以在运行时根据需要将这些对象替换为不同的状态或策略。</p>
<p>例如，如果<code>Employee</code>对象的类型会在其生命周期中改变，那么使用状态模式可以在不同的状态之间切换而不需要创建和销毁对象。</p>
<p><strong>不能使用子类的情况：</strong></p>
<ul>
<li><strong>类型动态变化</strong>：如果对象的类型在其生命周期中需要改变，使用子类就不太适合了。因为一旦创建了一个对象的实例，它的类就不能改变了。</li>
<li><strong>类爆炸</strong>：如果类型代码的组合非常多，创建对应的子类会导致类数量爆炸，增加系统复杂性。</li>
<li><strong>多维度变化</strong>：如果对象的行为由多个独立的维度影响，那么使用子类可能会导致重复代码。在这种情况下，策略模式可以让你独立地改变对象的各个方面。</li>
<li><strong>共享行为</strong>：如果不同的类型代码共享一些行为，使用子类可能会导致这些共享行为的重复实现。而状态/策略模式允许共享行为被多个状态/策略共用。</li>
</ul>
<h5 id="Replace-Array-with-Object"><a href="#Replace-Array-with-Object" class="headerlink" title="Replace Array with Object"></a>Replace Array with Object</h5><p>If there are arrays among the variables, use <strong>Replace Array with Object</strong>.</p>
<p><img src="/posts/Code-Refactor/primitive_obsession_7.png" alt="primitive_obsession_7"></p>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>Code becomes more flexible thanks to use of objects instead of primitives.</p>
<p>Better understandability and organization of code. Operations on particular data are in the same place, instead of being scattered. No more guessing about the reason for all these strange constants and why they’re in an array.</p>
<p>Easier finding of duplicate code.</p>
<h3 id="Long-Parameter-List"><a href="#Long-Parameter-List" class="headerlink" title="Long Parameter List"></a>Long Parameter List</h3><blockquote>
<p>More than three or four parameters for a method</p>
</blockquote>
<h4 id="原因：-1"><a href="#原因：-1" class="headerlink" title="原因："></a>原因：</h4><p>在面向对象编程中，一个核心原则是降低类之间的耦合度，即使类之间的依赖关系最小化。这通常被视为一种良好的设计实践，因为它可以增加代码的模块性和可重用性，并简化系统的测试和维护。</p>
<p>考虑一个生成报告的方法，需要多种数据（如标题、页码、内容等）。最初，这些数据的获取可能直接在方法内部进行，使得方法与数据源高度耦合。为了降低耦合，决定在调用该生成报告方法之前先在外部准备好所有必要的数据，然后通过参数传递给方法：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportGenerator</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateReport</span><span class="params">(String title, <span class="type">int</span> pageNumber, List&lt;String&gt; content)</span> {</span><br><span class="line">        <span class="comment">// 生成报告的逻辑</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportService</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">prepareAndGenerateReport</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> dataSource.getTitle(); <span class="comment">// 获取标题</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageNumber</span> <span class="operator">=</span> dataSource.getPageNumber(); <span class="comment">// 获取页码</span></span><br><span class="line">        List&lt;String&gt; content = dataSource.getContent(); <span class="comment">// 获取内容</span></span><br><span class="line">        <span class="type">ReportGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReportGenerator</span>();</span><br><span class="line">        generator.generateReport(title, pageNumber, content); <span class="comment">// 传递参数</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>尽管这种设计减少了<code>ReportGenerator</code>对数据来源的直接依赖，提高了类之间的独立性，但它也引入了长参数列表的问题。当方法依赖于多个外部创建的对象时，这些对象必须通过方法的参数列表传递，导致参数数量急剧增加。</p>
<h4 id="方案-2"><a href="#方案-2" class="headerlink" title="方案"></a>方案</h4><h5 id="Replace-Parameter-with-Method-Call"><a href="#Replace-Parameter-with-Method-Call" class="headerlink" title="Replace Parameter with Method Call"></a>Replace Parameter with Method Call</h5><p>假如某些arguments是<code>另一个object</code>方法执行的结果，可以将这些arguments替换为<code>方法内部的</code>Method Call。</p>
<p><img src="/posts/Code-Refactor/long_parameter_list_1.png" alt="long_parameter_list_1"></p>
<h5 id="Preserve-Whole-Object"><a href="#Preserve-Whole-Object" class="headerlink" title="Preserve Whole Object"></a>Preserve Whole Object</h5><p>我们可以pass一个包含所有需要参数的object到方法里</p>
<p><img src="/posts/Code-Refactor/long_parameter_list_2.png" alt="long_parameter_list_2"></p>
<h5 id="Introduce-Parameter-Object"><a href="#Introduce-Parameter-Object" class="headerlink" title="Introduce Parameter Object"></a>Introduce Parameter Object</h5><p>和上面的方法其实有点类似上面的是将被调用本身的object存入，这个是创建一个新的object存入，这个方法适用于parameters 来自于不同的source。</p>
<p><img src="/posts/Code-Refactor/long_parameter_list_3.png" alt="long_parameter_list_3"></p>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><p>比较简单，但是如果去掉某个参数会导致耦合度增加，那就不要删掉了</p>
<h3 id="Data-Clumps"><a href="#Data-Clumps" class="headerlink" title="Data Clumps"></a>Data Clumps</h3><blockquote>
<p>Different Parts of the code contain identical groups of variables. These Clumps should be turned into their own classes</p>
</blockquote>
<h4 id="原因-2"><a href="#原因-2" class="headerlink" title="原因"></a>原因</h4><p>封装失败导致的，相关连的变量应该被组合为一个对象。所以可以 尝试删除一个变量然后看看其他值是否仍然有意义。比如：如果删除了 <code>user</code> 后，剩余的 <code>startDate</code>, <code>endDate</code>, 和 <code>roomNumber</code> 仍描述了预订的时间和地点，但缺少了执行操作的用户信息，这是业务逻辑不完整的表现。这说明 <code>startDate</code>, <code>endDate</code>, <code>roomNumber</code>, 和 <code>user</code> 这组变量彼此之间存在强烈的逻辑关联，应该一起考虑，它们的组合描述了一个完整的业务操作 —— 预订或取消预订一个会议室。</p>
<h4 id="方案-3"><a href="#方案-3" class="headerlink" title="方案"></a>方案</h4><h5 id="Extract-Class"><a href="#Extract-Class" class="headerlink" title="Extract Class"></a>Extract Class</h5><p><img src="/posts/Code-Refactor/Data_Clumps_1.png" alt="Data_Clumps_1"></p>
<h5 id="Introduce-Parameter-Object-1"><a href="#Introduce-Parameter-Object-1" class="headerlink" title="Introduce Parameter Object"></a>Introduce Parameter Object</h5><p><img src="/posts/Code-Refactor/Data_Clumps_2.png" alt="Data_Clumps_2"></p>
<h5 id="Preserve-Whole-Object-1"><a href="#Preserve-Whole-Object-1" class="headerlink" title="Preserve Whole Object"></a>Preserve Whole Object</h5><p>传入参数所对应的对象，而不是单独的几个field</p>
<p><img src="/posts/Code-Refactor/Data_Clumps_3.png" alt="Data_Clumps_3"></p>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><p>解决方案很多和长参数列表类似，其实就是通过抽出到某一个class或者直接使用从而避免长/重复Clumps</p>
<h2 id="Object-Orientation-Abusers"><a href="#Object-Orientation-Abusers" class="headerlink" title="Object-Orientation Abusers"></a>Object-Orientation Abusers</h2><blockquote>
<p>不规范的使用oop</p>
</blockquote>
<h3 id="Switch-Statements"><a href="#Switch-Statements" class="headerlink" title="Switch Statements"></a>Switch Statements</h3><h4 id="原因-3"><a href="#原因-3" class="headerlink" title="原因"></a>原因</h4><blockquote>
<p>非常复杂的<code>switch</code>或者<code>if</code></p>
</blockquote>
<p>一般原因可能是一开始很小但是随着不停的加入条件但是单块swtich不断变大。</p>
<p>在oop中，条件判断应该很少，这是因为OOP可以使用多态的特性</p>
<p>比如：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 switch 的传统方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performOperation</span><span class="params">(String userType)</span> {</span><br><span class="line">    <span class="keyword">switch</span> (userType) {</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"Admin"</span>:</span><br><span class="line">            performAdminOperation();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"Moderator"</span>:</span><br><span class="line">            performModeratorOperation();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"User"</span>:</span><br><span class="line">            performUserOperation();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">"Invalid user type"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用多态的 OOP 方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">performOperation</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Admin</span> <span class="keyword">implements</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performOperation</span><span class="params">()</span> {</span><br><span class="line">        performAdminOperation();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Moderator</span> <span class="keyword">implements</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performOperation</span><span class="params">()</span> {</span><br><span class="line">        performModeratorOperation();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegularUser</span> <span class="keyword">implements</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performOperation</span><span class="params">()</span> {</span><br><span class="line">        performUserOperation();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>通过采用多态性，每个用户类负责定义其操作的具体实现，系统的其他部分则不需要知道用户的具体类型，也不需要 <code>switch</code> 语句。这样做提高了代码的模块化和可维护性，并使得添加新的用户类型变得非常容易。</p>
<h4 id="方案-4"><a href="#方案-4" class="headerlink" title="方案"></a>方案</h4><h5 id="Isolate-switch-Operator"><a href="#Isolate-switch-Operator" class="headerlink" title="Isolate switch Operator"></a>Isolate <code>switch</code> Operator</h5><p>To isolate switch and put it in the right class, need <code>Extract Method</code> and the <code>Move Method</code></p>
<p>Extract the swtich logic to a code block:</p>
<p><img src="/posts/Code-Refactor/switch_statements_1.png" alt="switch_statements_1"></p>
<p>Move the method:</p>
<p><img src="/posts/Code-Refactor/switch_statements_2.png" alt="switch_statements_2"></p>
<p>(PS: 感觉这种方法没有什么意义，本质上就是将在另一个class中被经常调用的方法给挪过去，然后调用reference，本质上像是一个Util class)</p>
<h5 id="Get-Rid-of-Type-Codes"><a href="#Get-Rid-of-Type-Codes" class="headerlink" title="Get Rid of Type Codes"></a>Get Rid of Type Codes</h5><p>这个其实在17514中提到过，少使用 instanceof，多使用多态性质</p>
<p>当被用于检查type时，use Replace Type Code with Subclasses or Replace Type Code with State/Strategy</p>
<p>Replace Type Code with Subclasses:<br><img src="/posts/Code-Refactor/switch_statements_3.png" alt="switch_statements_3"></p>
<p>Replace Type Code with State/Strategy Pattern:</p>
<p><img src="/posts/Code-Refactor/switch_statements_4.png" alt="switch_statements_4"></p>
<p>理解两者的不同确实需要更具体的代码示例来阐明。让我们通过具体示例更清晰地区分策略模式和状态模式，并强调在实际使用中它们的区别。</p>
<p>策略模式的示例：支付方式选择</p>
<p>假设我们有一个电子商务系统，用户可以选择不同的支付方式（例如信用卡支付、PayPal支付等）。这些支付方式可以被视为不同的策略，用户可以根据自己的需求选择使用哪种支付策略。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支付策略接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 信用卡支付策略</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreditCardPayment</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> {</span><br><span class="line">        System.out.println(<span class="string">"Paid "</span> + amount + <span class="string">" using Credit Card."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// PayPal支付策略</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaypalPayment</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">int</span> amount)</span> {</span><br><span class="line">        System.out.println(<span class="string">"Paid "</span> + amount + <span class="string">" using PayPal."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端使用策略</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCart</span> {</span><br><span class="line">    <span class="keyword">private</span> PaymentStrategy paymentStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ShoppingCart</span><span class="params">(PaymentStrategy paymentStrategy)</span> {</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategy = paymentStrategy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentStrategy</span><span class="params">(PaymentStrategy paymentStrategy)</span> {</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategy = paymentStrategy;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(<span class="type">int</span> amount)</span> {</span><br><span class="line">        paymentStrategy.pay(amount);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>(<span class="keyword">new</span> <span class="title class_">CreditCardPayment</span>());</span><br><span class="line">        cart.checkout(<span class="number">100</span>);  <span class="comment">// 使用信用卡支付</span></span><br><span class="line"></span><br><span class="line">        cart.setPaymentStrategy(<span class="keyword">new</span> <span class="title class_">PaypalPayment</span>());</span><br><span class="line">        cart.checkout(<span class="number">200</span>);  <span class="comment">// 更改为使用 PayPal 支付</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在这个例子中，<code>ShoppingCart</code> 对象可以在不同的支付策略之间灵活切换，但它自身的状态并没有改变，这反映了策略模式的典型用法。</p>
<p>状态模式的示例：电视状态控制</p>
<p>现在，让我们考虑一个电视机，它有多种状态（如开启、关闭、静音等）。这些状态决定了电视机的行为，状态改变意味着电视行为的改变。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 电视状态接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TVState</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pressPowerButton</span><span class="params">()</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OnState</span> <span class="keyword">implements</span> <span class="title class_">TVState</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressPowerButton</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Turning TV off."</span>);</span><br><span class="line">        <span class="comment">// 切换到关闭状态</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OffState</span> <span class="keyword">implements</span> <span class="title class_">TVState</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressPowerButton</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Turning TV on."</span>);</span><br><span class="line">        <span class="comment">// 切换到开启状态</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 电视类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TV</span> {</span><br><span class="line">    <span class="keyword">private</span> TVState state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TV</span><span class="params">(TVState state)</span> {</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(TVState state)</span> {</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressPowerButton</span><span class="params">()</span> {</span><br><span class="line">        state.pressPowerButton();</span><br><span class="line">        <span class="comment">// 根据当前状态改变行为</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">TV</span> <span class="variable">tv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TV</span>(<span class="keyword">new</span> <span class="title class_">OffState</span>());</span><br><span class="line">        tv.pressPowerButton();  <span class="comment">// 开启电视</span></span><br><span class="line"></span><br><span class="line">        tv.setState(<span class="keyword">new</span> <span class="title class_">OnState</span>());</span><br><span class="line">        tv.pressPowerButton();  <span class="comment">// 关闭电视</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在这个例子中，<code>TV</code> 类的行为随着内部状态的改变而改变。状态的改变通常由状态自身来管理（虽然在这里是由外部控制以简化示例），这反映了状态模式的核心特性：对象通过改变状态改变其行为。</p>
<p>区别总结</p>
<p>在策略模式中，选择哪种策略通常是由客户端决定，策略之间相互独立，不知道彼此的存在。而在状态模式中，状态通常是有相互转换逻辑的，每个状态知道在某个动作下应该转换到哪个新状态，这是内部管理的。</p>
<p>这两个模式虽然结构相似，但它们在设计意图、管理责任和使用上下文中有明显区别。策略模式强调选择，状态模式强调变化。</p>
<h5 id="Replace-Conditional-With-Polymorphism"><a href="#Replace-Conditional-With-Polymorphism" class="headerlink" title="Replace Conditional With Polymorphism"></a>Replace Conditional With Polymorphism</h5><p><img src="/posts/Code-Refactor/switch_statements_5.png" alt="switch_statements_5"></p>
<h5 id="Replace-Parameters-switching-with-Explicit-Methods"><a href="#Replace-Parameters-switching-with-Explicit-Methods" class="headerlink" title="Replace Parameters switching with Explicit Methods"></a>Replace Parameters <code>switch</code>ing with Explicit Methods</h5><p><img src="/posts/Code-Refactor/switch_statements_6.png" alt="switch_statements_6"></p>
<h5 id="Introduce-Null-Object"><a href="#Introduce-Null-Object" class="headerlink" title="Introduce Null Object"></a>Introduce Null Object</h5><p>If one of the conditional option is <code>null</code>, use Null Object instead</p>
<p><img src="/posts/Code-Refactor/switch_statements_7.png" alt="switch_statements_7"></p>
<h3 id="Temporary-Field"><a href="#Temporary-Field" class="headerlink" title="Temporary Field"></a>Temporary Field</h3><blockquote>
<p>Temporary fields get their values (and thus are needed by objects) only under certain circumstances. Outside of these circumstances, they’re empty.</p>
</blockquote>
<p>这种一般是因为之后要生成数据现在搁置的情况或者是数据在固定某个if分支中才会被赋值</p>
<p>另一种情况是避免长参数列表而引入。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReportGenerator</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> specialCalculationValue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateReport</span><span class="params">(Data data)</span> {</span><br><span class="line">        <span class="keyword">if</span> (data.isSpecialCase()) {</span><br><span class="line">            specialCalculationValue = complexCalculation(data);</span><br><span class="line">            <span class="comment">// 使用 specialCalculationValue 进行报告生成</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 其他情况下，specialCalculationValue 不被使用，保持为空</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">complexCalculation</span><span class="params">(Data data)</span> {</span><br><span class="line">        <span class="comment">// 复杂计算</span></span><br><span class="line">        <span class="keyword">return</span> data.getValue() * <span class="number">42</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84/">代码重构</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/" title="前置知识"><img class="cover" src="/posts/%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/cover.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">前置知识</div></div></a></div><div class="next-post pull-right"><a href="/posts/Trie%E6%A0%91/" title="Trie树"><img class="cover" src="/posts/Trie%E6%A0%91/Trie_Cover.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Trie树</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ruobing Wang</div><div class="author-info__description">Work Hard, Play Harder</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ruobing1997"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Ruobing1997" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://www.linkedin.com/in/robin97/" target="_blank" title="Linkedin"><i class="fab fa-linkedin"></i></a><a class="social-icon" href="https://www.instagram.com/ruobingwang123/" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a><a class="social-icon" href="mailto:ruobing2@andrew.cmu.edu" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Code-Smells"><span class="toc-number">1.</span> <span class="toc-text">Code Smells</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bloaters"><span class="toc-number">1.1.</span> <span class="toc-text">Bloaters:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Long-Method"><span class="toc-number">1.1.1.</span> <span class="toc-text">Long Method</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">原因：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">方案：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Extract-Method"><span class="toc-number">1.1.1.2.1.</span> <span class="toc-text">Extract Method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Reduce-local-variables-and-parameters-before-extracting-a-method"><span class="toc-number">1.1.1.2.2.</span> <span class="toc-text">Reduce local variables and parameters before extracting a method</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Replace-Method-with-Method-Object"><span class="toc-number">1.1.1.2.3.</span> <span class="toc-text">Replace Method with Method Object</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Conditionals-and-Loops"><span class="toc-number">1.1.1.2.4.</span> <span class="toc-text">Conditionals and Loops</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Large-Class"><span class="toc-number">1.1.2.</span> <span class="toc-text">Large Class</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Extract-as-Class"><span class="toc-number">1.1.2.2.1.</span> <span class="toc-text">Extract (as) Class</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Extract-as-Subclass"><span class="toc-number">1.1.2.2.2.</span> <span class="toc-text">Extract (as) Subclass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Extract-as-Interface"><span class="toc-number">1.1.2.2.3.</span> <span class="toc-text">Extract (as) Interface</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Duplicate-Observed-Data"><span class="toc-number">1.1.2.2.4.</span> <span class="toc-text">Duplicate Observed Data</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Primitive-Obsession"><span class="toc-number">1.1.3.</span> <span class="toc-text">Primitive Obsession</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-1"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88-1"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Replace-Set-of-Fields-with-Object"><span class="toc-number">1.1.3.2.1.</span> <span class="toc-text">Replace Set of Fields with Object</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Primitive-Fields-in-Method-Parameters"><span class="toc-number">1.1.3.2.2.</span> <span class="toc-text">Primitive Fields in Method Parameters</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Get-Rid-of-Type-codes"><span class="toc-number">1.1.3.2.3.</span> <span class="toc-text">Get Rid of Type codes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Replace-Array-with-Object"><span class="toc-number">1.1.3.2.4.</span> <span class="toc-text">Replace Array with Object</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Long-Parameter-List"><span class="toc-number">1.1.4.</span> <span class="toc-text">Long Parameter List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0%EF%BC%9A-1"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">原因：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88-2"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Replace-Parameter-with-Method-Call"><span class="toc-number">1.1.4.2.1.</span> <span class="toc-text">Replace Parameter with Method Call</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Preserve-Whole-Object"><span class="toc-number">1.1.4.2.2.</span> <span class="toc-text">Preserve Whole Object</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Introduce-Parameter-Object"><span class="toc-number">1.1.4.2.3.</span> <span class="toc-text">Introduce Parameter Object</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Data-Clumps"><span class="toc-number">1.1.5.</span> <span class="toc-text">Data Clumps</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-2"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88-3"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Extract-Class"><span class="toc-number">1.1.5.2.1.</span> <span class="toc-text">Extract Class</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Introduce-Parameter-Object-1"><span class="toc-number">1.1.5.2.2.</span> <span class="toc-text">Introduce Parameter Object</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Preserve-Whole-Object-1"><span class="toc-number">1.1.5.2.3.</span> <span class="toc-text">Preserve Whole Object</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-number">1.1.5.3.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object-Orientation-Abusers"><span class="toc-number">1.2.</span> <span class="toc-text">Object-Orientation Abusers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Switch-Statements"><span class="toc-number">1.2.1.</span> <span class="toc-text">Switch Statements</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0-3"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88-4"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">方案</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Isolate-switch-Operator"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">Isolate switch Operator</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Get-Rid-of-Type-Codes"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">Get Rid of Type Codes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Replace-Conditional-With-Polymorphism"><span class="toc-number">1.2.1.2.3.</span> <span class="toc-text">Replace Conditional With Polymorphism</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Replace-Parameters-switching-with-Explicit-Methods"><span class="toc-number">1.2.1.2.4.</span> <span class="toc-text">Replace Parameters switching with Explicit Methods</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Introduce-Null-Object"><span class="toc-number">1.2.1.2.5.</span> <span class="toc-text">Introduce Null Object</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Temporary-Field"><span class="toc-number">1.2.2.</span> <span class="toc-text">Temporary Field</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/" title="滑动窗口"><img src="/posts/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/sliding_window.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="滑动窗口"/></a><div class="content"><a class="title" href="/posts/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/" title="滑动窗口">滑动窗口</a><time datetime="2024-11-01T06:43:44.992Z" title="Updated 2024-11-01 02:43:44">2024-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88/" title="队列和栈"><img src="/posts/%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88/%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88_Cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="队列和栈"/></a><div class="content"><a class="title" href="/posts/%E9%98%9F%E5%88%97%E5%92%8C%E6%A0%88/" title="队列和栈">队列和栈</a><time datetime="2024-05-15T04:17:52.593Z" title="Updated 2024-05-15 00:17:52">2024-05-15</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Ruobing Wang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script async src="/config/js/categoryBar.js"></script><script src="/js/nav.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>